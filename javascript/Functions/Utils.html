<script>


        // ═══════════════════════════════════════════════════════════════════════════════
        // FUNCIONES DE UTILIDAD
        // ═══════════════════════════════════════════════════════════════════════════════

        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            
            const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
            alertDiv.innerHTML = `
                <span class="alert-icon">${icon}</span>
                <span class="alert-message">${message}</span>
                <button class="alert-close" onclick="this.parentElement.remove()">×</button>
            `;
            
            alertContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function toggleValorRango() {
            const tipoElemento = document.getElementById('tipoElemento').value;
            const esActivoFijo = document.getElementById('esActivoFijo').value;
            const activoFijoGroup = document.getElementById('activoFijoGroup');
            const valorRangoGroup = document.getElementById('valorRangoGroup');
            
            const elementosActivoFijo = ['MOLDES E INSERTOS', 'MAQUINARIA', 'MOBILIARIOS'];
            
            if (elementosActivoFijo.includes(tipoElemento)) {
                activoFijoGroup.style.display = 'block';
                
                if (esActivoFijo === 'SI') {
                    valorRangoGroup.style.display = 'none';
                    document.getElementById('valorRango').value = '';
                } else {
                    valorRangoGroup.style.display = 'block';
                }
            } else if (tipoElemento) {
                activoFijoGroup.style.display = 'none';
                valorRangoGroup.style.display = 'block';
                document.getElementById('esActivoFijo').value = 'NO';
            } else {
                activoFijoGroup.style.display = 'none';
                valorRangoGroup.style.display = 'none';
            }
        }

function updateUserInterface() {
    if (currentUser) {
        document.getElementById('userName').textContent = currentUser.nombre;
        document.getElementById('userRole').textContent = currentUser.rol;
        document.getElementById('userAvatar').textContent = currentUser.nombre.charAt(0).toUpperCase();
        
        // Mostrar menú según el rol
        if (currentUser.rol === 'JEFE' || currentUser.rol === 'ADMIN') {
            document.getElementById('navAdministracion').style.display = 'block';
            document.getElementById('navValidadas').style.display = 'block';
            showAdmin();
        } else if (currentUser.rol === 'AMBIENTAL') {
            document.getElementById('navAdministracion').style.display = 'none';
            document.getElementById('navValidadas').style.display = 'block';
            // Para usuarios AMBIENTAL, mostrar directamente el panel de validadas
            showValidadas();
        } else {
            document.getElementById('navAdministracion').style.display = 'none';
            document.getElementById('navValidadas').style.display = 'none';
            showNewRequest();
        }
    }
}

        function formatDate(date) {
            if (!date) return 'N/A';
            
            if (typeof date === 'string') {
                const parsedDate = new Date(date);
                if (!isNaN(parsedDate.getTime())) {
                    return parsedDate.toLocaleDateString('es-ES');
                }
                return date;
            }
            
            if (date instanceof Date) {
                return date.toLocaleDateString('es-ES');
            }
            
            const d = new Date(date);
            if (!isNaN(d.getTime())) {
                return d.toLocaleDateString('es-ES');
            }
            
            return 'N/A';
        }

</script>